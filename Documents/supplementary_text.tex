\documentclass{article}

\usepackage[utf8]{inputenc}
\usepackage{microtype}
\usepackage{geometry}

\usepackage{amsmath}
\usepackage{graphicx}
\usepackage{tikz}

\usepackage[font = {sf}, labelfont = {bf},
  labelsep = period, singlelinecheck = off]{caption}
\usepackage[font = {sf}]{floatrow}
\usepackage{tabularx}

\usepackage[noblocks]{authblk}
\renewcommand{\Authsep}{, }
\renewcommand{\Authand}{ \& }
\renewcommand{\Authands}{ \& }
\renewcommand{\Affilfont}{\small}

\usepackage[pdfborder={0 0 0}]{hyperref}

\usepackage[style = science, article-title = true, maxnames = 100]{biblatex}
\addbibresource{supplementary_text.bib}
\newcommand{\labeltitlepunc}{}
\DeclareBibliographyDriver{incollection}{%
  \usebibmacro{bibindex}%
  \usebibmacro{begentry}%
  \usebibmacro{author/translator+others}%
  \setunit{\labelnamepunct}\newblock
  \printlist{language}%
  \newunit\newblock
  \usebibmacro{byauthor}%
  \newunit\newblock
  \usebibmacro{title}%
  \usebibmacro{in:}%
  \usebibmacro{maintitle+booktitle}%
  \newunit\newblock
  \usebibmacro{byeditor+others}%
  \newunit\newblock
  \printfield{volumes}%
  \newunit\newblock
  \printfield{note}%
  \newunit\newblock
  \usebibmacro{publisher+location+date}%
  \newunit\newblock
  \printfield{volume}
  \newunit
  \usebibmacro{chapter+pages}%
  \newunit\newblock
  \iftoggle{bbx:isbn}
    {\printfield{isbn}}
    {}%
  \newunit\newblock
  \usebibmacro{doi+eprint+url}%
  \newunit\newblock
  \usebibmacro{addendum+pubstate}%
  \setunit{\bibpagerefpunct}\newblock
  \usebibmacro{pageref}%
  \newunit\newblock
  \usebibmacro{related}%
  \usebibmacro{finentry}%
}

\newcommand{\comment}[1]{\textbf{[#1]}}
\newcommand{\md}{\mathrm{d}}
\newcommand{\mT}{\mathrm{T}}
\renewcommand{\vec}[1]{\mathbf{#1}}
\newcommand{\mat}[1]{\mathbf{#1}}
\newcommand{\me}{\mathrm{e}}
\DeclareMathOperator{\Uniform}{Uniform}
\DeclareMathOperator{\Triangular}{Triangular}
\DeclareMathOperator{\Lognormal}{Lognormal}
\DeclareMathOperator{\BetaPERT}{Beta-PERT}

\newcommand{\labelPrefix}{S}
\renewcommand{\thesection}{\labelPrefix\arabic{section}}
\renewcommand{\theequation}{\labelPrefix\arabic{equation}}
\renewcommand{\thefigure}{\labelPrefix\arabic{figure}}
\renewcommand{\thetable}{\labelPrefix\arabic{table}}
\renewcommand{\figurename}{Fig.}


\title{Supporting online material for\\
  \emph{Effectiveness of UNAIDS targets and HIV vaccination across 127
    countries}}

\author[1*]{Jan Medlock}
\author[2]{Abhishek Pandey}
\author[2]{Alyssa S.~Parpia}
\author[2]{Amber Tang}
\author[2]{Laura A.~Skrip}
\author[2]{Alison P.~Galvani}
\affil[1]{Department of Biomedical Sciences, Oregon State University,
  106 Dryden Hall, Corvallis, OR, 97331-4801, USA}
\affil[2]{Center for Infectious Disease Modeling and Analysis, Yale
  School of Public Health, 135 College Street, New Haven, USA}
\affil[*]{To whom correspondence should be addressed.  E-mail:
  \href{mailto:jan.medlock@oregonstate.edu}{
    \texttt{jan.medlock@oregonstate.edu}}}


\begin{document}

\maketitle

\section{Mathematical model}

We developed a continuous-time, compartmental model that divides
people aged $15$\;y and older into non-overlapping HIV states.  We
chose to consider only these ages because they are the vast majority
of PLHIV, 93\% in 2014 \cite{UNICEF}, and because HIV and demographic
data are often stratified into these ages, although some data used to
parametrize the model was only available for ages $15$--$49$ rather
than for ages $15$ and older.  The background mortality rate ($\mu$)
in each of the 127 countries was collected from published estimates
\cite{World_Development_Indicators2013-ee}.  The recruitment rate into
ages $15\;\text{y}$ and older group ($\kappa$) was set by the difference
between the country's population growth rate \cite{WorldBankpg} and
its background mortality rate
\cite{World_Development_Indicators2013-ee}, as would be true if the
population was at its stable age structure.

Our model has 8 HIV states (\autoref{model_diag}): susceptible to HIV
infection ($S$ is the number of people susceptible), vaccinated
against HIV ($R$), acute HIV infection ($A$), undiagnosed HIV
infection ($U$), diagnosed but untreated HIV infection ($D$), treated
without viral suppression ($T$), viral suppression ($V$), and having
AIDS ($W$).  Transitions between model states are governed by a series
of differential equations parametrized using values estimated from
other studies and from incidence and prevalence data
(\autoref{model_param}).  The model is deterministic, but uncertainty
in the parameters is treated by running the model many times with
samples from the parameter distributions and summarizing the model
outcomes using the median, 1st and 3rd quartiles (i.e., 25th and 75th
percentiles), and 5th and 95th percentiles.

\begin{figure}
  \centering
  \input{diagram}
  \caption{Model diagram.}
  \label{model_diag}
\end{figure}

\begin{table}
  \begin{center}
    \begin{tabularx}{\textwidth}{lXlll}
      \hline
      & Definition & Value & Reference \\
      \hline
      $\mu$ & Background death rate & Country specific, Table S2
      & \cite{World_Development_Indicators2013-ee} \\
      $\kappa$ & Recruitment rate & Country specific, Table S2
      & \cite{World_Development_Indicators2013-ee, WorldBankpg} \\
      $\delta$	& Rate of leaving acute infection
      & $\Triangular$(2, 4.14, 9.6)\;y$^{-1}$
      & \cite{Hollingsworth2008-iy} \\
      $\sigma$	& Rate of developing AIDS without viral suppression
      & 0.1064\;y$^{-1}$ & \cite{Morgan2002-cq} \\
      $\theta$ & Rate of developing AIDS with viral suppression
      & Eq.~(\ref{theta}) & --- \\
      $\gamma$ & Rate of viral suppression
      & $\Uniform$(0.5, 1.5)\;y$^{-1}$
      & \cite{Currie2009-yz} \\
      $\nu$ & Death rate from AIDS & 0.5\;y$^{-1}$
      & \cite{Morgan2002-cq} \\
      $\rho$ & Vaccine efficacy & 50\%\,[30\%, 70\%] & --- \\
      $\omega$	& Reduction in lifetime with viral suppression
      & $\Uniform$(5, 8)\;y
      & \cite{Unaids2014-ue, Samji2013-kf} \\
      $\tau_{A}$ & Transmissibility during acute phase
      & $\Triangular$(0.0039, 0.0082, 0.0150)
      & \cite{Skarbinski2015-ni,Wawer2005-us}\\
      $\tau_{U}$ & Transmissibility after acute phase
      & $\Triangular$(0.00077, 0.0014, 0.00251)
      & \cite{Hughes2012-so} \\
      $\varepsilon$ & Relative transmissibility with
      viral suppression & $\BetaPERT$(0.08, 0.002, 0.57)
      & \cite{Donnell2010-xo} \\
      $n$ & Coital acts per year & $\Uniform$(96, 108)
      & \cite{Wawer2005-us,Abdool_Karim2010-cm}\\
      $\alpha$ & Diagnosis rate & See eq.~(\ref{diagnosis_rate}) & --- \\
      $\phi$ & Treatment rate & See eq.~(\ref{treatment_rate}) & --- \\
      $\psi$ & Rate of relapse to untreated & See eq.~(\ref{relapse_rate})
      & --- \\
      $\zeta$ & Vaccination rate & See eqs.~(\ref{vaccination_rate}) & --- \\
      \hline
    \end{tabularx}
    \caption{Model parameters. $\Triangular$, $\Uniform$, and
      $\BetaPERT$ are sampling distributions: see
      \autoref{uncertainty} for a full description.  For vaccine
      efficacy, $50\%$ was the baseline, and $30\%$ and $70\%$ were
      also used in scenario analysis.}
    \label{model_param}
  \end{center}
\end{table}

People susceptible to HIV ($S$) progress to acute infection ($A$)
according to the force of infection ($\lambda$,
eq.~\eqref{force_of_infection}), which depends on the HIV transmission
rate, estimated from the country-specific incidence and prevalence
data (\autoref{model_fitting}), adjusted for the current number of
acutely infected, untreated or ineffectively treated, and viral
suppression PLHIV.  Acute infection is characterized by high viral
loads and lasts an average of 2.90 [95\% confidence interval 1.23,
6.00]\;months \cite{Hollingsworth2008-iy}.  (We converted these
durations to rates like $1 / 2.90\;\text{month$^{-1}$} \approx
4.14\;\text{y$^{-1}$}$ and set the parameter using random samples from
$\Triangular(2, 4.14, 9.6)\;\text{y$^{-1}$}$ to capture the
uncertainty in its value.  See \autoref{uncertainty} for the
definition of $\Triangular(a, b, c)$ and other distributions.)  We
assumed that people remain undiagnosed during their acute infection
phase. After acute infection, people move into the chronic undiagnosed
class ($U$).  People in the undiagnosed class will be diagnosed at the
rate $\alpha$, which is determined by the country's current diagnosis
level and its diagnosis target (\autoref{targets}).  Diagnosed people
($D$) transition to the treated compartment ($T$) upon starting ART at
the rate $\phi$, dependent on the country's current treatment level
and its treatment target (\autoref{targets}).  After some time,
treated people then transition to the viral-suppression class ($V$),
at the rate $\gamma$.  We took $\gamma$ as a random sample from
$\Uniform(0.5, 1.5)\;\text{y$^{-1}$}$, that is, viral suppression
occurs after between 8 months and 2 years on treatment
\cite{Currie2009-yz}.  Disengagement from treatment moves people from
treated ($T$) and viral suppression ($V$) at the rate $\psi$,
dependent on the current level of viral suppression and the country's
target (\autoref{targets}), back to the diagnosed class ($D$).

PLHIV without viral suppression (compartments $U$, $D$, and $T$)
develop AIDS (compartment $W$) after an average duration of 10.4 y
\cite{Morgan2002-cq}, i.e., with transition rate
$\sigma = 0.1064\;\text{y$^{-1}$}$.  People who have achieved viral
suppression ($V$) develop AIDS at rate $\theta$, slower than PLHIV
without viral suppression.  People with viral suppression are
estimated to live $5$--$8$\;y shorter lives than the non-HIV infected
\cite{Unaids2014-ue, Samji2013-kf}, which we quantified by randomly
sampling the parameter $\omega$ from $\Uniform(5, 8)\;\text{y}$.
Assuming no relapse to untreated, the duration of viral suppression is
\begin{equation}
  \frac{1}{\theta + \mu} = \frac{1}{\mu} - \omega - \frac{1}{\nu}.
\end{equation}
The term to the left of the equals sign is the time until leaving
viral suppression by either progression to AIDS (at rate $\theta$) or
background mortality (at rate $\mu$).  The term to the right of the
equals sign is the lifespan of the non-HIV infected, minus the
reduction in life due to having HIV with viral suppression, minus the
duration of the AIDS stage.  Solving for $\theta$ gives the rate of
progression to AIDS with viral suppression as
\begin{equation}
  \label{theta}
  \theta = \frac{1}{1/\mu - \omega - 1/\nu} - \mu.
\end{equation}

In scenarios with vaccine, susceptible people are vaccinated at rate
$\zeta$, depending on the country's current vaccination coverage and
its coverage target (\autoref{targets}), transitioning into the
vaccinated compartment ($R$), where the vaccine reduces their force of
infection by the efficacy factor $\rho$.  We took the base-case
efficacy to be $50\%$ and varied it to $30\%$ and $70\%$ in analyzing
vaccination scenarios (\autoref{uncertainty}).  We did not model
specific vaccine dose regime, such that implicit in our efficacy
parameter is the assumption that boosters will be used to maintain
efficacy over time.  Without vaccine, $\zeta = 0$.

We also added differential equations to track the cumulative number of
new infections ($Y$) and AIDS deaths ($Z$) over the model period.

The model equations are
\begin{equation}
  \label{model_eqns}
  \begin{split}
    \frac{\md S}{\md t} &= \kappa N - \lambda S - \zeta S- \mu S,
    \\
    \frac{\md R}{\md t} & = \zeta S - (1 - \rho) \lambda R - \mu R,
    \\
    \frac{\md A}{\md t} &= \lambda S + (1 - \rho) \lambda R - \delta A - \mu A,
    \\
    \frac{\md U}{\md t} &= \delta A - \alpha U - \mu U - \sigma U,
    \\
    \frac{\md D}{\md t} &=  \alpha U + \psi T + \psi V
    - \phi D - \mu D - \sigma D,
    \\
    \frac{\md T}{\md t} &= \phi D - \psi T - \gamma T - \mu T
    - \sigma T,
    \\
    \frac{\md V}{\md t} &= \gamma T - \psi V - \mu V - \theta V,
    \\
    \frac{\md W}{\md t} &= \sigma U + \sigma D + \sigma T + \theta V -
    \nu W,
    \\
    \frac{\md Y}{\md t} &= \lambda \big[S + (1 - \rho) R\big],
    \\
    \frac{\md Z}{\md t} &= \nu W,
  \end{split}
\end{equation}
with force of infection
\begin{equation}
  \label{force_of_infection}
  \begin{split}
    \lambda &= \frac{\beta_A A + \beta_U (U + D + T) + \beta_V V}{N},
    \\
    N &= S + R +  A + U + D + T + V,
    \\
    \beta_A &= \eta \left[1 - (1 - \tau_A)^n\right]
    \\
    \beta_U &= \eta \left[1 - (1 - \tau_U)^n\right]
    \\
    \beta_V &= \eta \left[1 - (1 - \tau_V)^n\right]
    \\
    \tau_V &= \varepsilon \tau_U,
  \end{split}
\end{equation}
where the $\tau$'s are the relative transmissibility of people with
acute ($A$), unsuppressed ($U$ and $T$), and suppressed ($V$)
infections, $n$ is the annual number of coital acts, and $\eta$ is the
country-specific transmission rate (\autoref{model_fitting}).  For
transmissibility during the acute phase, we sampled from
$\Triangular$(0.0039, 0.0082, 0.0150)
\cite{Skarbinski2015-ni,Wawer2005-us}, whereas, for transmissibility
for unsuppressed people, we sampled from
$\Triangular(0.00077, 0.0014, 0.00251)$ \cite{Hughes2012-so}.  The
transmissibility of people with viral suppression relative to those
without suppression has been estimated at 0.08 (95\% confidence
interval 0.002, 0.57) \cite{Donnell2010-xo}: because of the extremely
long left tail, we chose to sample the relative transmissibility
$\varepsilon$ from $\BetaPERT(0.08, 0.002, 0.57)$ rather than a
$\Triangular$ distribution.  (See \autoref{uncertainty} for a full
description of $\BetaPERT(a, b, c)$.)  The annual number of coital $n$
was sampled from $\Uniform(96, 108)$
\cite{Wawer2005-us,Abdool_Karim2010-cm}.

For year 2015, the number of people aged 15--49 years, $M(2015)$; the
prevalence, $p_I(2015)$; the proportion diagnosed, $p_D(2015)$; the
proportion treated, $p_T(2015)$; and proportion with viral
suppression, $p_V(2015)$ (\autoref{data_sources}) were used to
initialize the model.  Due to a lack of data on acute infections, and
since the acute phase is so much shorter than the other stages, we
assumed that initially there were no acute infections.  Due to a lack
of comprehensive data on PLAIDS in each country, we assumed that the
proportion of diagnosed, untreated people ($D + W$) who have AIDS
($W$) in year 2015 was
\begin{equation}
  p_A = \frac{\sigma}{\sigma + \nu},
\end{equation}
which is the equilibrium fraction of diagnosed people ($D + W$) who
have AIDS ($W$) in the absence of treatment and background mortality.
The number initially vaccinated was set to 0.  The initial cumulative
number of new infections and AIDS deaths were set to 0.  Thus, the
model initial conditions are
\begin{equation}
  \label{initial_conditions}
  \begin{split}
    S(2015) &= \big(1 - p_I(2015)\big) M(2015), \\
    R(2015) &= 0, \\
    A(2015) &= 0, \\
    U(2015) &= \big(1 - p_D(2015)\big) p_I(2015) M(2015), \\
    D(2015) &= \big(1 - p_A\big) p_D(2015) \big(1 - p_T(2015)\big)
    p_I(2015) M(2015), \\
    T(2015) &= p_D(2015) p_T(2015) \big(1 - p_V(2015)\big)
    p_I(2015) M(2015), \\
    V(2015) &= p_D(2015) p_T(2015) p_V(2015) p_I(2015) M(2015), \\
    W(2015) &= p_A p_D(2015) \big(1 - p_T(2015)\big) p_I(2015) M(2015), \\
    Y(2015) &= 0, \\
    Z(2015) &= 0.
  \end{split}
\end{equation}


\section{Target rates}
\label{targets}

The current proportion of PLHIV who know their diagnosis is
\begin{equation}
  p_D(t) = \frac{D(t) + T(t) + V(t) + W(t)}
  {A(t) + U(t) + D(t) + T(t) + V(t) + W(t)},
\end{equation}
and the desired target for the current level of diagnosis is
$p_D^*(t)$.  For the rate of new diagnosis, we used the function
\begin{equation}
  \label{diagnosis_rate}
  \alpha(t) = \alpha_{\max} H\big(p_D^*(t) - p_D(t)\big),
\end{equation}
where $H(x)$ is the Heaviside-like function
\begin{equation}
  H(x) =
  \begin{cases}
    0 & \text{if $x < 0$},
    \\
    x / \chi & \text{if $0 \leq x \leq \chi$},
    \\
    1 & \text{if $x > \chi$},
  \end{cases}
\end{equation}
with $\chi = 0.001$, which rapidly switches from $H = 0$ when $x < 0$
to $H = 1$ when $x > 0$.  The linear segment connecting $H = 0$ and
$H = 1$ was used to avoid difficulties in computing numerical
solutions that occur when using a discontinuous function.  The
function for the rate of new diagnoses \eqref{diagnosis_rate} allows
new diagnoses ($\alpha(t) > 0$) when the current diagnosis level is
below the target ($p_D^*(t) > p_D(t)$), and stops new
diagnoses ($\alpha(t) = 0$) when the current diagnosis level is at or
above target.  We took $\alpha_{\max} = 1\;\text{y$^{-1}$}$.
  
The proportion of diagnosed people who are treated is
\begin{equation}
  p_T(t) = \frac{T(t) + V(t) + W(t)}{D(t) + T(t) + V(t) + W(t)}.
\end{equation}
Like the rate of new diagnosis, the rate of enrolling new people in
treatment is
\begin{equation}
  \label{treatment_rate}
  \phi(t) = \phi_{\max} H\big(p_T^*(t) - p_T(t)\big),
\end{equation}
with $\phi_{\max} = 10$, allowing new treatment ($\phi(t) > 0$) when
the current treatment level is below the target ($p_T^*(t) > p_T(t)$)
and stopping new treatment ($\phi(t) = 0$) when the current treatment
level is at or above target.

The proportion of people on ART who have achieved viral suppression is
\begin{equation}
  p_V(t) = \frac{V(t)}{T(t) + V(t)}.
\end{equation}
The rate of people relapsing to untreated is
\begin{equation}
  \label{relapse_rate}
  \psi(t) = \psi_{\max} H\big(p_V(t) - p_V^*(t)\big),
\end{equation}
with $\psi_{\max} = 1$, which, unlike diagnosis and treatment rates,
prevents relapses ($\psi(t) = 0$) when the current level of viral
suppression is below the target ($p_V^*(t) > p_V(t)$) and allows
relapses ($\psi(t) > 0$) when the current level of viral suppression
is at or above target.  We chose to vary the relapse rate to achieve
the desired level of viral suppression because achieving viral
suppression seems to depend on the time on treatment (i.e.,
$1 / \gamma$), while relapse rates are difficult to estimate.

The proportion of susceptible people vaccinated is
\begin{equation}
  p_R(t) = \frac{R(t)}{S(t) + R(t)}.
\end{equation}
Like diagnosis and treatment, the vaccination rate is
\begin{equation}
  \label{vaccination_rate}
  \zeta(t) = \zeta_{\max} H\big(p_R^*(t) - p_R(t)\big),
\end{equation}
with $\zeta_{\max} = 1$, allowing vaccination ($\zeta(t) > 0$) when
the current vaccine coverage level is below the target
($p_R^*(t) > p_R(t)$) and stopping vaccination ($\zeta(t) = 0$) when
the current vaccine coverage is at or above target.

We modeled 3 different targets for the proportion diagnosed ($p_D$), the
proportion treated ($p_T$), and the proportion with viral suppression ($p_V$).
\begin{description}
\item[Status quo] Given initial proportions $p_D(2015)$, $p_T(2015)$,
  and $p_V(2015)$, the targets are for the proportion to remain fixed
  at that level for all times:
  \begin{equation}
    \label{status_quo_target}
    \begin{split}
      p_D^*(t) &= p_D(2015), \\
      p_T^*(t) &= p_T(2015), \\
      p_V^*(t) &= p_V(2015).
    \end{split}
  \end{equation}

\item[UNAIDS 90--90--90] The UNAIDS 90--90--90 target is for $p_D$,
  $p_T$, and $p_V$ to all be raised to $90\%$ by 2020.  We implemented
  this target as linear increases from the 2015 levels, each up to
  $90\%$ in 2020, and constant at $90\%$ from 2020 to 2035, except if
  an initial level is above $90\%$ then it remains constant from 2015
  to 2035 so that meeting the UNAIDS target does not worsen any aspect
  of the treatment cascade.  That is,
  \begin{equation}
    \label{unaids90_targets}
    \begin{split}
      p_D^*(t) &=
      \begin{cases}
        F\big(t, 2015, p_D(2015), 2020, 0.9\big)
        & \text{if $p_D(2015) < 0.9$},
        \\
        p_D(2015) & \text{if $p_D(2015) \geq 0.9$}.
      \end{cases}
      \\
      p_T^*(t) &=
      \begin{cases}
        F\big(t, 2015, p_T(2015), 2020, 0.9\big)
        & \text{if $p_T(2015) < 0.9$},
        \\
        p_T(2015) & \text{if $p_T(2015) \geq 0.9$}.
      \end{cases}
      \\
      p_V^*(t) &=
      \begin{cases}
        F\big(t, 2015, p_V(2015), 2020, 0.9\big)
        & \text{if $p_V(2015) < 0.9$},
        \\
        p_V(2015) & \text{if $p_V(2015) \geq 0.9$}.
      \end{cases}
    \end{split}
  \end{equation}
  where
  \begin{equation}
    \label{F}
    F(t, t_0, x_0, t_1, x_1) =
    \begin{cases}
      x_0 & \text{if $t < t_0$},
      \\
      x_0 + (x_1 - x_0) \frac{t - t_0}{t_1 - t_0} &
      \text{if $t_0 \leq t < t_1$},
      \\
      x_1 & \text{if $t \geq t_1$},
    \end{cases}
  \end{equation}
  is constant at $x_0$ for $t < t_0$, linearly connects $x_0$ at
  $t_0$ to $x_1$ at $t_1$ for $t_0 \leq t < t_1$, and is constant at
  $x_1$ for $t \geq t_1$.

\item[UNAIDS 95--95--95] The UNAIDS 95--95--95 target is to achieve
  90--90--90 by 2020 and then for $p_D$, $p_T$, and $p_V$ to all be
  raised to $95\%$ by 2030.  We implemented this target as for
  90--90--90 from 2015 to 2020, and then linear increases from the
  2020 levels up to $95\%$ in 2030, again with the exception that if
  an initial level is above $95\%$ then it remains constant from 2015
  to 2035.  That is,
  \begin{equation}
    \label{unaids95_targets}
    \begin{split}
      p_D^*(t) &=
      \begin{cases}
        G\big(t, 2015, p_D(2015), 2020, 0.9, 2030, 0.95\big)
        & \text{if $p_D(2015) < 0.9$},
        \\
        F\big(t, 2020, p_D(2015), 2030, 0.95\big)
        & \text{if $0.9 \leq p_D(2015) < 0.95$},
        \\
        p_D(2015) & \text{if $p_D(2015) \geq 0.95$},
      \end{cases}
      \\
      p_T^*(t) &=
      \begin{cases}
        G\big(t, 2015, p_T(2015), 2020, 0.9, 2030, 0.95\big)
        & \text{if $p_T(2015) < 0.9$},
        \\
        F\big(t, 2020, p_T(2015), 2030, 0.95\big)
        & \text{if $0.9 \leq p_T(2015) < 0.95$},
        \\
        p_T(2015) & \text{if $p_T(2015) \geq 0.95$},
      \end{cases}
      \\
      p_V^*(t) &=
      \begin{cases}
        G\big(t, 2015, p_V(2015), 2020, 0.9, 2030, 0.95\big)
        & \text{if $p_V(2015) < 0.9$},
        \\
        F\big(t, 2020, p_V(2015), 2030, 0.95\big)
        & \text{if $0.9 \leq p_V(2015) < 0.95$},
        \\
        p_V(2015) & \text{if $p_V(2015) \geq 0.95$},
      \end{cases}
    \end{split}
  \end{equation}
  where
  \begin{equation}
    G(t, t_0, x_0, t_1, x_1, t_2, x_2) =
    \begin{cases}
      x_0 & \text{if $t < t_0$},
      \\
      x_0 + (x_1 - x_0) \frac{t - t_0}{t_1 - t_0} &
      \text{if $t_0 \leq t < t_1$},
      \\
      x_1 + (x_2 - x_1) \frac{t - t_1}{t_2 - t_1} &
      \text{if $t_1 \leq t < t_2$},
      \\
      x_2 & \text{if $t \geq t_2$},
    \end{cases}
  \end{equation}
  is constant at $x_0$ for $t < t_0$, linearly connects $x_0$ at $t_0$
  to $x_1$ at $t_1$ for $t_0 \leq t < t_1$, linearly connects $x_1$ at
  $t_1$ to $x_2$ at $t_2$ for $t_1 \leq t < t_2$, and is constant at
  $x_2$ for $t \geq t_2$, and $F$ is as in \eqref{F}.

\end{description}

For vaccination, we assume that vaccination rollout begins in year
$t_V = 2020$ (or $t_V = 2025$ in vaccine scenario analysis,
\autoref{uncertainty}), that rollout linearly increases the proportion
of non-infected population covered from 0\% by $r_V = 25\%$ per year
(or $r_V = 10\%$ per year) up to $c_V = 70\%$ (or $c_V = 50\%$ or
$c_V = 90\%$) and staying constant thereafter.  Thus, the vaccination
target is
\begin{equation}
  \label{vaccination_target}
  p_R^*(t) =
  \begin{cases}
    0 & \text{if $t < t_V$},
    \\
    r_V (t - t_V) & \text{if $t_V \leq t < T_V$},
    \\
    c_V & \text{if $t \geq T_V$},
  \end{cases}
\end{equation}
where $T_V = t_V + c_V / r_V$ is the time when rollout reaches
the full coverage $c_V$.


\section{Uncertainty analysis}
\label{uncertainty}

Projections were generated for each country through model simulations
using 1000 random samples from published parameter distributions
(table S1) and the country-specific estimated distribution of the
transmission rate. We evaluated the global and country-level impacts
of meeting the UNAIDS targets and vaccine deployment on four outcome
measures: HIV incidence, PLHIV, PLAIDS, and AIDS-related deaths
between 2015 and 2035. Our base-case scenario assumed maintenance of
the status quo: that 2015 levels of the proportion of PLHIV diagnosed
(pD), proportion of those diagnosed on ART (pT), and proportion of
those on treatment who have achieved viral suppression (pV) continue
unchanged until 2035. The intervention scenarios were (1.) the
attainment of the 90–90–90 target by linear increases in pD, pT, and
pV until 2020 followed by maintenance of those levels until 2035, and
(2.) linear increase in the diagnosis and treatment levels to the
90–90–90 target by 2020, a linear increase from 90–90–90 to the
95–95–95 target by 2030, and maintenance of the 95–95–95 levels to
2035. (For 90–90–90, if any initial level was above 90\%, it was kept
constant going forward so that the intervention did not worsen
coverage.  Likewise, for 95–95–95, any initial level above 95\% was
kept constant.)  For vaccination, we assumed deployment of a vaccine
with 50\% efficacy in 2020 with coverage increasing linearly by 25\%
per year, continuing up to 70\% at 2.8 years post-rollout, and
maintaining constant 70\% coverage thereafter.  We also performed a
partial rank correlation coefficient (PRCC) sensitivity analysis for
each model parameter and a scenario analysis to account for
uncertainty in the profile of the prospective vaccine.


$\Uniform(a, b)$ is the uniform random variable with minimum $a$
and maximum $b$: it has density function
\begin{equation}
  \label{uniform}
  p_{\Uniform}(x) =
  \begin{cases}
    \frac{1}{b - a} & \text{if $a \leq x \leq b$,}
    \\
    0 & \text{otherwise.}
  \end{cases}
\end{equation}
We defined the mode for the uniform distribution to be the midpoint
$\frac{b - a}{2}$.
%
$\Triangular(a, b, c)$ is the triangular random variable
distribution with minimum $a$, mode $b$, and maximum $c$: it has
density function
\begin{equation}
  \label{triangular}
  p_{\Triangular}(x) =
  \begin{cases}
    \frac{2 (x - a)}{(c - a)(b - a)} & \text{if $a \leq x \leq b$,}
    \\
    \frac{2 (c - x)}{(c - a)(c - b)} & \text{if $b \leq x \leq c$,}
    \\
    0 & \text{otherwise.}
  \end{cases}
\end{equation}
$\BetaPERT(a, b, c)$ is the beta-PERT probability distribution
\cite{malcom1959} with minimum $a$, mode $b$, and maximum $c$: it has
density function
\begin{equation}
  \label{betaPERT}
  p_{\BetaPERT}(x) =
  \begin{cases}
    \frac{(x - a)^{v - 1} (c - x)^{w - 1}}{(c - a)^{v + w - 2} B(v, w)}
    & \text{if $a \leq x \leq c$,}
    \\
    0 & \text{otherwise,}
  \end{cases}
\end{equation}
where
\begin{equation}
  \begin{split}
    \mu &= \frac{a + \lambda b + c}{\lambda + 2},
    \\
    v &= \frac{(\mu - a)(2 b - a - c)}{(b - \mu) (c - a)},
    \\
    w &= \frac{v (a - \mu)}{\mu - c},
  \end{split}
\end{equation}
and $B(v, w)$ is the standard beta function \cite[\S 6.2]{davis1972}.
We used the standard value of $\lambda = 4$.
%
$\Lognormal(\mu, \sigma^2)$ is the lognormal random variable: it has
density function
\begin{equation}
  p_{\Lognormal}(x) = \frac{1}{x \sigma \sqrt{2 \pi}}
  \exp\left(- \frac{\left(\log x - \mu\right)^2}{2 \sigma^2}\right).
\end{equation}

\comment{Vaccine scenarios.}


\section{Data sources}
\label{data_sources}

For 127 countries, we found sufficient data to parametrize our model:
these data consisted of estimates of longitudinal HIV incidence and
prevalence for ages 15–49 years starting as early as 1990 in some
countries and running through 2015, along with basic demographics.

Several sources provided information to parameterize our model at the
country level. Demographic data, including population growth rate
\cite{WorldBankpg}, death rate
\cite{World_Development_Indicators2013-ee}, and number of people aged
15--49 years \cite{The_World_Bank2016-fd} were obtained from the World
Bank. Longitudinal HIV incidence and prevalence estimates for the
15--49 age group, spanning from as early as 1990 to 2015, was
primarily derived from the AIDSinfo database produced by UNAIDS
\cite{Unaids2016-an}. Other sources included UNAIDS Country Progress
Reports \cite{Unaids2016-am} published from 2012 to 2016 and AIDS Data
Hub \cite{AIDSdatahub-fg}, which compiles data from UNAIDS, UNICEF,
WHO, and the Asian Development Bank. These sources were also used to
inform the initial conditions for the model: the number of people who
have been diagnosed with HIV, who are on ART, and who have viral
suppression or have been retained on treatment for at least 12
months. Where data were not available from these sources, alternative
resources such as peer-reviewed journal articles and country health
ministry reports were consulted.  We found sufficient data to
parametrize our mathematical modeling for 127 countries.  See
Supplemental data files for full information on data sources for each
country.  The data files are also available in the public source-code
repository \cite{medlock2016-git}.

A few countries—e.g., Bulgaria, Timor-Leste, and Yemen—currently have
low HIV prevalence but relatively high incidence, resulting in large
estimated transmission rates, leading to rapid projected growth of
their HIV epidemics by 2035. The apparent low prevalence and high
incidence may, at least in part, be due to the resolution in UNAIDS
data (0.1\% for prevalence, 0.01\% for annual per-capita incidence).
Results for such countries should be considered in light of this
limitation.


\section{Model fitting}
\label{model_fitting}

Using available historical data for incidence and prevalence, and
published transmission estimates, we estimated transmission rates for
people with acute infection, unsuppressed viral load and suppressed
viral load. Our calibration method provided a recent snapshot of
country-specific transmission, while using historical data to smooth
out variations.

We first estimated country-specific rates of HIV transmission for each
of the available historical data point for incidence and
prevalence. The calculation involved a simplified force of infection
that initially assumed no differences in transmission risk among
acute, unsuppressed, suppressed, and AIDS classes due to the general
lack of historical data on diagnosis and treatment. We calculated a
time-independent aggregate transmission rate by taking an exponential
weighted mean of the historical (i.e., time-dependent) transmission
rates for each given country (\autoref{transmission_rate}). The
aggregate transmission rate was then combined with estimated HIV
transmission risk by stage of HIV infection
\cite{Hollingsworth2008-iy} and treatment status \cite{Wawer2005-us}
to calculate separate transmission rates for unsuppressed, acute, and
viral-suppression people. These rates were used to simulate model
projections through 2035.



{We calibrated longitudinal HIV incidence and prevalence data from
  1990 to 2015 incidence in addition to data on $p_{D}$, $p_{T}$ and
  $p_{V}$ levels in 2015 to estimate the rate of transmission for each
  country. The calculation involved a simplified force of infection:}

\begin{align}
  \label{foi}
  \begin{split}
  \lambda(t) &  =    \frac{\beta_{A} A + \beta_{U}(U+D+T)+\beta_{V}V+0
               W}{N} \\
             &  =  \beta \frac{I}{N},
             \end{split}
\end{align}
where $\beta$ is the estimated time-independent aggregate transmission rate under the
assumption that there is no difference in transmission risk among acute, unsuppressed, suppressed, and AIDS classes.

$I = A+U+D+T+V+W$ is the total number of people living with HIV. Therefore, the per-capita
incidence is
\begin{equation}
i(t) = \lambda(t) \frac{S(t)}{N(t)}
= \beta(t) \frac{I(t)}{N(t)} \frac{S(t)}{N(t)} =\beta(t) p(t) (1-p(t)),
\end{equation}
where $p(t)$ is the prevalence. Thus, we can estimate the
transmission rate at each historical time point using the incidence
and prevalence data,
\begin{equation}
  \label{trans_rate}
  \beta(t) = \frac{i(t)}{p(t)(1-p(t))}
\end{equation}


We estimated the time-independent aggregated transmission rate ($\beta$)
by taking the exponential weighted mean of transmission rates
\eqref{trans_rate}.


Rearranging equation \eqref{foi}, the transmission rate for PLHIV
without viral suppression can be written as
\begin{equation}
\label{betaU}
  \beta_{U} = \frac{\beta I}{\frac{\beta_{A}}{\beta_{U}}A +
    U+D+T+\frac{\beta_{V}}{\beta_{U}}V}
\end{equation}


Next, we assumed that the relative risk of acute HIV transmission
($\beta_{AU} = \beta_{A}/\beta_{U}$) and virally suppressed HIV
transmission ($\beta_{VU} = \beta_{V}/\beta_{U}$) with respect to the
unsuppressed transmission remains constant worldwide and calculated
these values using the data from Rakai, Uganda
\cite{Wawer2005-us}. The aggregate rate of transmission ($\beta$) can
then be combined with eqs.~\eqref{betaU} to calculate transmission
rates for unsuppressed PLHIV, acute PLHIV and suppressed PLHIV as,
\begin{align}
  \beta_{U} & = \frac{\beta I}{\beta_{AU}A +
              U+D+T+\beta_{VU}V}, \\
  \beta_{A} & = \beta_{AU}\beta, \\
  \beta_{V} & = \beta_{VU} \beta.
\end{align}
that we use to simulate our model forward and project results up to 2035.
\\

\comment{Need to add stuff about how we generate distribution of
  transmission rates}




\begin{figure}
  \centering
  \includegraphics{../Codes/plots/transmission_rate.pdf}
  \caption{Country-specific transmission rates were calculated based
    on the relative contributions of people with acute infection,
    unsuppressed viral load or suppressed viral load to overall
    transmission (\autoref{model_fitting}). The estimates were
    calibrated to data on country-level incidence and/or prevalence to
    account for variation in historical incidence while accurately
    reflecting recent HIV rates.}
  \label{transmission_rate}
\end{figure}


\section{Source code}

The model simulation and analysis tools, written in Python, are
publicly available at
\url{https://github.com/janmedlock/HIV-95-vaccine/}
\cite{medlock2016-git}.


\section{Analysis}

We evaluated the global and country-specific impacts of meeting the
UNAIDS targets and vaccine deployment on four outcome measures: HIV
incidence, PLHIV, number of people with AIDS, and AIDS-related deaths
between 2015 and 2035. Calibrating our model to historical data on
prevalence and incidence, we projected the anticipated trajectories of
the outcomes using country-specific transmission rates across the
intervention scenarios outlined below.  Our base-case scenario assumed
maintenance of the status quo: that 2015 levels of the proportion of
PLHIV diagnosed ($p_{D}$), proportion of those diagnosed on ART
($p_{T}$), and proportion of those on treatment who have achieved
viral suppression ($p_{V}$) continue unchanged until 2035.  The
intervention scenarios were 1.) the attainment of the 90--90--90
target by linear increases in $p_{D}$, $p_{T}$, and $p_{V}$ until 2020
followed by maintenance of those levels until 2035, and 2.) linear
increase in the diagnosis and treatment levels to the 90--90--90
targets by 2020, a linear increase from 90--90--90 to the 95--95--95
target by 2030, and maintenance of the 95--95--95 levels to 2035. (For
90--90--90, if any initial level was above 90\%, it was kept constant
going forward so that the intervention did not worsen coverage.
Likewise, for 95--95--95, any initial level above 95\% was kept
constant.)  For vaccination, we assumed deployment of a vaccine with
50\% efficacy in 2020 with coverage increasing linearly from 0\% to
50\% at 2 years post-rollout and maintaining constant coverage after
reaching 70\%. The added benefit of vaccination was considered in the
context of status quo diagnosis and treatment, achieving the UNAIDS
90–90–90 goal by 2020 followed by maintenance, and achieving the
95–95–95 goal by 2030 followed by maintenance.  Projections were
generated through model simulations based on published parameter
distributions (\autoref{model_param}) and country-specific estimated
transmission rate distributions. The parameters were sampled using
latin hypercube sampling \cite{blower1994} and the variance reduction
technique of running different interventions with random parameter
values \cite{shechter2006}.

Model outcomes were projected until 2035 for each of the 127 countries
with sufficient data on status quo rates of diagnosis and treatment
and on historical incidence or prevalence
(\hyperref[effectiveness_Global]{\autoref*{effectiveness_Global}}--\ref{effectiveness_Zimbabwe}). The
median estimates with interquartile ranges are presented between 2015
and 2035 for number of PLHIV, per-capita incidence, PLAIDS, and number
of HIV-related deaths under the status quo and five intervention
scenarios: vaccination only, attaining the UNAIDS 90--90--90 target,
attaining the 90--90--90 target and vaccination, attaining the UNAIDS
95--95--95 target, and attaining the 95--95--95 target and
vaccination.  The results from the country were aggregated to the
regional and global levels by adding the numbers of people in each
compartment over time and then PLHIV, per-capita incidence, PLAIDS,
and HIV-related deaths were calculated from the aggregates.

We calculated partial rank correlation coefficients (PRCC)
\cite{blower1994} to measure the independent effect of each parameter
on model projections of HIV incidence (\autoref{PRCCs}). Furthermore,
due to uncertainty surrounding the prospective vaccine, we obtained
model projections using six additional vaccine scenarios by
considering alternative estimates of efficacy (30\%, 70\%), coverage
(50\%, 90\%), speed of scale up (10\% coverage per year), and first
year of availability (2025).

\begin{figure}
  \centering
  \includegraphics{../Codes/plots/prcc.pdf}
  \caption{Parameter sensitivity of global infections averted from
    2015 to 2035.  Left is the parameter sensitivity of infections
    averted by 95--95--95, relative to status quo.  Right is the
    parameter sensitivity of vaccination with status quo levels of
    diagnosis and treatment, relative to status quo.  Sensitivity is
    measured by the partial rank correlation coefficient (PRCC).}
  \label{PRCCs}
\end{figure}


\clearpage
\printbibliography


\clearpage
\newpage
\vspace*{3in}
\section{Model results by region and country}
\newpage
\input{../Codes/plots/effectiveness_all/all}


\end{document}
